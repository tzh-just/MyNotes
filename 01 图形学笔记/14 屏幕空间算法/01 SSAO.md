AO 的核心是，如何采样点，以及判断采样点是否被遮蔽。
**采样点的选取**
在法线方向的半球中生成采样点，并且根据距离着色点的距离做加权。
**判断是否被遮蔽**
1. 将采样点都变换到视口，采样深度缓冲，判断两者深度的大小，如比深度图更远则被遮蔽。
2. 

URP 的五个 Pass
- Pass 1 对深度贴图和法线的采样并进行环境光遮蔽的计算
- 在 pass 2 水平方向和 pass 3 垂直方向上做模糊处理，pass 4 生成最终的模糊的 AO 图
- Pass 5 和不透明物体进行混合
屏幕空间环境光遮蔽，适合延迟渲染，因为可以通过 GBuffer 中的法线、坐标和深度等信息来近似实时计算间接光的阴影。如果是前向渲染，则需要额外保存一张 normal rt

$$
L_o(p,\omega_o)=\frac{\rho}{\pi} \cdot L_{i}(p) \cdot \int_{\Omega^{+}} V\left(\mathrm{p}, \omega_{i}\right) \cos \theta_{i} \mathrm{~d} \omega_{i}
$$
根据深度和像素坐标，反推出像素在世界空间的坐标，结合法线，在半球面上采样与周围的遮蔽关系。
在球内随机采样点，判断点能不能被着色点观察到而不是被遮挡。深度图可以认为是几何的近似，与 shadowmap 类似，将随机采样的点经过变换后得到屏幕坐标和深度，通过坐标查询深度图，如果小于深度图中的坐标，说明该点没有被遮蔽，反之则被遮蔽。

模糊

没有法线信息时，无法确定采样半球，只能以球体考虑，退而求其次，只有当采样点过半为被遮蔽时，才考虑 AO，此时无法考虑 cosine 的加权。

【优化】降低中间纹理的分辨率，减少带宽的消耗，或者不做模糊
【优化】减少采样数量
【优化】使用 HBAO 和 GTAO 代替
![](Pasted%20image%2020230627145251.png)
【缺点】SSAO 由于在屏幕空间计算，附近像素的遮挡不一定是同一物体，来自其他物体的遮挡可能深度相差甚远，造成不该出现的 AO