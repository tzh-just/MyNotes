包围盒可以是 box 也可以是 sphere 等，box 更精确更贴近模型，sphere 的计算更加快速。包围盒常用于射线检测、碰撞检测，主要目的是将细碎的三角形作为一个整体进行求交测试，只有通过了包围盒的测试，才继续对包围盒内的三角形测试。进一步地在包围盒内继续划分包围盒，形成树状结构，可以进一步加快测试速度。

已知射线和球体的定义，若二者相交，将射线定义代入球体定义后即可得到二者交点的定义。
$$
(O+tD-C) \cdot (O+tD-C)=R^2
$$
$$
D \cdot Dt^2 +  2(O-C) \cdot Dt + (O-C) \cdot (O-C) -R^2 
\\= 0
$$
经过变形可以得到一个以时间 $t$  为未知数的一元二次方程。解出一元二次方程得到射线与球体相交的时间 $t$ ，再代入射线定义即可得到交点坐标。

$$
\begin{array} {l}
a = D \cdot D
\\
b = 2(O-C) \cdot D
\\
c= (O-C) \cdot (O-C) -R^2
\\ \\
x=\frac{-b \pm \sqrt{b^2 -4ac}}{2 a}
\end{array}
$$
设 $h = \frac{b}{2}$ ，可以简化求根公式，若确保光线的方向 $D$ 是归一化的矢量，则求根公式可以进一步简化。
$$
x=\frac{-h \pm \sqrt{h^2 -ac}}{a}
\\\\
x=-h \pm \sqrt{h^2 -c}
$$

和球体相交相同，只需要将射线的定义代入平面的定义即可，且为一个简单的以时间 $t$ 为未知数的一元一次方程。
$$
(O+tD-P^{\prime}) \cdot N = 0
\\
\\
t = \frac{(P^{\prime} - O) \cdot N}{D \cdot N}
$$
二维矩形可由两个互相平行的对边组成，在二维矩形所在平面上的射线必定会与两个对边相交。若射线经过二维矩形，则射线经过两对边的时间必定有重叠的部分。可以说只有射线和两个对边都第一次相交了才是真正地进入了矩形，只要有一个对边第二次相交了就已经离开了矩形。

将二维矩形的情形推广到三维的包围盒，包围盒是由三个互相平行的对面组成的。已知平面定义是由平面内任一点 $P$ 与垂直于该平面的任意法线 $N$ 决定，而包围盒的最小点坐标和最大点坐标就是能囊括在于包围盒六个面的平面内任一点。对于轴向包围盒，所有平面的法向量 N 都是单位向量，因此只需要点坐标的任一维即可计算出在该维度时间 $t$ ，即可以直接一步到位计算出三个对面所需的时间 $t$。
$$
t = 
\frac{(P^{\prime} - O) \cdot N}{D \cdot N}
$$

$$
\begin{bmatrix}  
   t_x  \\  
  t_y \\
  t_z
\end{bmatrix}  
= 
\frac
{P^{\prime} - O}
{D}
$$
分别将最小点坐标和最大点坐标代入 $P^{\prime}$ ，解出两个三维的时间矢量。但计算出的时间大小顺序并不是最小点坐标和最大点坐标决定，而是光线的方向来决定。因此将两个矢量在各维度最小值和最大值重新分配为最小时间矢量和最大时间矢量 $T_{min}, T_{max}$。
在二维情形我们已经知道只有射线和两个对边都第一次相交了才是真正地进入了矩形，只要有一个对边第二次相交了就已经离开了矩形。三维情形下也是同样的道理，选取最小时间矢量 $T_{min}$ 中的最大值 $t_{enter}$， $T_{max}$ 中的最小值 $t_{exit}$ 。只有当离开的时间大于 0 ，且离开的时间大于等于进入的时间时，我们才认为射线击中了包围盒。
$$
\begin{array}{l}
t_{exit}>0
\\
t_{exit} + eps > t_{enter}
\end{array}
$$

由于浮点数精度的问题，当 $t_{exit}$ 大于 $t_{enter}$ 但二者又特别接近时，可能会出现 $t_{exit}$ 反而小于了 $t_{enter}$ 。所以建议为 $t_{exit}$ 增加一个 $epsilon = 0.0001$ 左右大小的修正值。
在除以光线方向 $D$ 时，存在一个除零问题。如果光线方向 $D$ 在任一维度为 $0 $ ，根据 IEEE 的浮点数标准，会得到正无穷 (1. #INF00 ) 或负无穷 (-1. #INF00 )。而分出最大时间矢量和最小时间矢量，然后选取最小值时间矢量中的最大值，最大时间矢量中的最小值，可以将无穷值排除掉。极端情况下光线方向 $D$ 三个维度都为 $0$，比如我们的最大值最小值都是正无穷，由于我们的条件是 $t_{exit} + eps > t_{enter}$ ，正无穷大于正无穷的比较是返回 `false` 的。
如果 $P^{\prime}-O$ 与光线方向 $D$ 同时为 $0$ ，根据 IEEE 的浮点数标准会得到 `NaN` (1. #IND00 ) 表示这不是数。`NaN` 和任何数进行任何比较结果都是 `false` 。